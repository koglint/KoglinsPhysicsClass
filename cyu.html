<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Check Your Understanding (CYU) Scores</title>
  <link rel="stylesheet" href="styles.css">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCCNFF9Au24okmKbH6ojbZB6xZIGddyo2U",
      authDomain: "koglinsphysicsclass.firebaseapp.com",
      projectId: "koglinsphysicsclass",
      storageBucket: "koglinsphysicsclass.appspot.com",
      messagingSenderId: "1051481871959",
      appId: "1:1051481871959:web:40bc24648d3a4f91f87512"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore(app);

    const modules = ["5.1", "5.2", "5.3", "6.1", "6.2"]; // Add more as needed

    // Load existing CYU data and populate the fields
    function loadCYUData(user) {
      const cyuContainer = document.getElementById('cyuContainer');
      modules.forEach(async (module) => {
        const inputField = document.getElementById(`cyu-${module}`);
        const cyuDoc = await getDoc(doc(db, "cyuScores", user.uid));
        if (cyuDoc.exists()) {
          const cyuData = cyuDoc.data();
          if (cyuData[module] !== undefined) {
            inputField.value = cyuData[module];
          }
        }
      });
    }

    // Save CYU data to Firestore
    async function saveCYUData() {
      const user = auth.currentUser;
      if (user) {
        const cyuData = {};
        modules.forEach(module => {
          const value = document.getElementById(`cyu-${module}`).value;
          cyuData[module] = value ? parseInt(value) : 0; // Default to 0 if no value is entered
        });
        await setDoc(doc(db, "cyuScores", user.uid), cyuData, { merge: true });
        alert("CYU scores saved successfully!");
      } else {
        alert("You must be logged in to save your CYU scores.");
      }
    }

    // Wait for the user to be authenticated before loading CYU data
    onAuthStateChanged(auth, (user) => {
      if (user) {
        loadCYUData(user);
      } else {
        alert("Please log in to access your CYU scores.");
      }
    });
  </script>
</head>
<body>
  <h1>Enter Your CYU Scores</h1>
  <div id="cyuContainer">
    <form id="cyuForm">
      ${modules.map(module => `
        <label for="cyu-${module}">${module}:</label>
        <input type="number" id="cyu-${module}" placeholder="0" min="0" max="100" required>
        <span>%</span>
        <br>
      `).join('')}
      <button type="button" onclick="saveCYUData()" class="save-cyu-button">Save</button>
    </form>
  </div>
</body>
</html>
